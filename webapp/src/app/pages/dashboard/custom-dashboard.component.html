<div class="animated fadeIn">

  <div class="row" *ngIf="!dashboardReady">
    Loading dashboard...
  </div>
  <div class="row" *ngIf="dashboardReady">
    <!-- Title -->
    <div class="col-md-8">
      <h2 class=""><i class="fa {{dashboard.icon}}"></i> {{dashboard.name}}</h2>
      <p class="blockquote" *ngIf="dashboard.description">{{dashboard.description}}</p>
    </div>
    <!-- End Title -->

    <!-- Buttons -->
    <div class="col-md-4">
      <button *ngIf="!editFlag" class="btn btn-info pull-right" (click)="editDashboard()"><i class="fa fa-pencil"></i> Edit dashboard
      </button>
      <button *ngIf="!editFlag" class="btn btn-success pull-right" (click)="addNewWidget()"><i class="fa fa-plus-circle"></i> Add widget
      </button>
      <button *ngIf="editFlag" class="btn btn-danger pull-right" (click)="cancel()"><i class="fa fa-ban"></i> Cancel
      </button>
    </div>
    <!-- End Buttons -->

    <!-- Edit Dashboard -->
    <div class="col-md-12" *ngIf="editFlag">
      <div class="card">
        <div class="card-header">
          <strong>Edit dashboard</strong>
        </div>
        <div class="card-block">
          <h4 class="text-center">Dashboard Information</h4>
          <hr>

          <!-- Form Begin -->
          <form class="form-horizontal" #editDashboardForm="ngForm">
            <div class="form-group row">
              <label class="col-md-3 form-control-label">Name</label>
              <div class="col-md-6">
                <input type="text" class="form-control" placeholder="Device name" name="dashboard.name" [(ngModel)]="dashboard.name">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-md-3 form-control-label">Description</label>
              <div class="col-md-6">
                <input type="text" class="form-control" placeholder="Dashboard description" name="dashboard.description" [(ngModel)]="dashboard.description">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-md-3 form-control-label">Icon <i class="fa {{dashboard.icon}}"></i></label>
              <div class="col-md-6">
                <angular2-multiselect #selectOneDashboardIcon
                                      name="iconDashboardSelect"
                                      [data]="fontAwesomeList"
                                      [(ngModel)]="selectedDashboardIcon"
                                      (onSelect)="dashboard.icon = $event.id; selectOneDashboardIcon.isActive = false;"
                                      (onDeSelect)="dashboard.icon = ''"
                                      [settings]="selectIconSettings">
                  <c-item>
                    <ng-template let-item="item">
                      <label style="color: #333;min-width: 150px;">{{item.itemName}}</label>
                      <i class="fa {{item.id}}" style="width: 16px; margin-right: 5px;"></i>
                    </ng-template>
                  </c-item>
                </angular2-multiselect>
              </div>
            </div>

            <button class="btn btn-sm btn-primary" [disabled]="!editDashboardForm.form.valid" (click)="saveDashboard()"><i
              class="fa fa-check"></i> Save dashboard
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteDashboard()"><i class="fa fa-trash"></i> Delete
              dashboard
            </button>
          </form>
        </div>
      </div>
    </div>
    <!-- End Edit dashboard -->
  </div>

  <hr>

  <!-- Show widgets -->
  <div class="row" *ngIf="widgets.length === 0">
    No widgets yet...
  </div>
  <div class="row" *ngIf="widgets.length > 0">
    <!-- For each widget -->
    <div *ngFor="let widget of widgets; let w = index" class="col-md-{{widget.width}}">
      <ng-container *ngIf="widget.type === 'divider';else typicalWidget">
        <div class="btn-toolbar pull-right">
          <div class="btn-group">
            <button class="btn btn-info" *ngIf="editFlag" (click)="editWidget(widget); addOrEditWidgetModal.show()"><i class="fa fa-pencil"></i></button>
            <button class="btn btn-danger" *ngIf="editFlag" (click)="deleteWidget(widget)"><i class="fa fa-trash"></i></button>
          </div>
        </div>
        <div class="font-weight-bold font-lg">
          {{widget.name}}
        </div>
        <hr>
      </ng-container>
      <ng-template #typicalWidget>
        <div class="card">
          <!-- card header -->
          <div class="card-header">
            <i class="fa {{widget.icon}} fa-lg"></i> <strong>{{widget.name}}</strong>
            <div class="btn-toolbar pull-right">
              <div class="btn-group">
                <button class="btn btn-info" *ngIf="editFlag" (click)="editWidget(widget); addOrEditWidgetModal.show()"><i class="fa fa-pencil"></i></button>
                <button class="btn btn-danger" *ngIf="editFlag" (click)="deleteWidget(widget)"><i class="fa fa-trash"></i></button>
              </div>
            </div>
          </div>
          <!-- End header -->

          <!-- Card body -->
          <div class="card-block">
            <ng-container *ngIf="!widget.ready">
              <div class="card-block">
                <div class="sk-chasing-dots">
                  <div class="sk-child sk-dot1"></div>
                  <div class="sk-child sk-dot2"></div>
                </div>
              </div>
            </ng-container>

            <ng-container *ngIf="widget.ready">
              <!-- Description -->
              <ng-container *ngIf="widget.description">
                <p>{{widget.description}}</p>
              </ng-container>

              <!-- Value -->
              <ng-container *ngIf="widget.type === 'value'">
                <div *ngIf="widget.data" class="text-center mx-auto font-weight-bold font-lg">
                  <ng-container *ngIf="!widget.data.value">
                    No data
                  </ng-container>
                  <ng-container *ngIf="widget.data.value && widget.data.unit">
                    {{widget.data.value + ' ' + widget.data.unit}}
                  </ng-container>
                  <ng-container *ngIf="widget.data.value && !widget.data.unit">
                    {{widget.data.value}}
                  </ng-container>
                </div>
              </ng-container>
              <!-- End Value -->

              <!-- Image -->
              <ng-container *ngIf="widget.type === 'image'">
                <div class="text-center mx-auto">
                  <img class="img-fluid" style="max-height: 300px" src="{{widget.image}}">
                </div>
              </ng-container>
              <!-- End Image -->

              <!-- Map -->
              <ng-container *ngIf="widget.type === 'map'">
                <agm-map id="{{widget.id}}"
                         #agmMap
                         (mapReady)="onMapLocationReady($event, widget.data)"
                         [latitude]="widget.options.lat"
                         [longitude]="widget.options.lng"
                         [zoom]="widget.options.zoom"
                         [fullscreenControl]="true"
                         [mapTypeId]="widget.options.mapTypeId !== 'custom' && widget.options.mapTypeId ? widget.options.mapTypeId : 'roadmap'"
                         [styles]="widget.options.style ? widget.options.style : ''">

                  <input #searchBoxInput *ngIf="!mobile" type="text" class="text-center" placeholder="Search for a place">

                  <ng-container *ngFor="let device of widget.data; let i = index">
                    <ng-container *ngIf="device.Messages && device.Messages[0].Geolocs">
                      <ng-container *ngFor="let geoloc of device.Messages[0].Geolocs">
                        <!-- Sigfox -->
                        <ng-container *ngIf="geoloc.type === 'sigfox'">
                          <agm-marker (mouseOut)="markerOut(i)" (mouseOver)="markerOver(i)" [zIndex]="3" [latitude]="geoloc.location.lat" [longitude]="geoloc.location.lng" [iconUrl]="'assets/img/markers/marker-sigfox.png'">
                            <agm-info-window id="{{geoloc.id}}">
                              <strong><b>ID: </b><span class="text-device">{{device.id}}</span></strong>
                              <br>
                              <strong *ngIf="device.name"><b>Name: </b>{{device.name}}</strong>
                              <br *ngIf="device.name">
                              <strong><b>Type: </b><span class="text-geoloc-sigfox">Sigfox</span></strong>
                              <br>
                              <strong><b>Date: </b>{{geoloc.createdAt | date:"dd/MM/yyyy"}}</strong>
                              <br>
                              <strong><b>Time: </b>{{geoloc.createdAt | date:"HH:mm:ss"}}</strong>
                              <br>
                              <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                            </agm-info-window>
                          </agm-marker>
                          <!-- Circle -->
                          <agm-circle *ngIf="isCircleVisible[i]" [visible]="isCircleVisible[i]" [zIndex]="1" [strokePosition]="CENTER" [strokeWeight]="1" [strokeColor]="'#8d5dd1'" [fillOpacity]="0.1" [fillColor]="'#8d5dd1'" [latitude]="geoloc.location.lat" [longitude]="geoloc.location.lng" [radius]="geoloc.accuracy">
                          </agm-circle>
                          <!-- End Circle -->
                        </ng-container>
                        <!-- Geoloc GPS -->
                        <ng-container *ngIf="geoloc.type === 'gps'">
                          <agm-marker [zIndex]="3" [latitude]="geoloc.location.lat" [longitude]="geoloc.location.lng" [iconUrl]="'assets/img/markers/marker-gps.png'">
                            <agm-info-window id="{{geoloc.id}}">
                              <strong><b>ID: </b><span class="text-device">{{device.id}}</span></strong>
                              <br>
                              <strong *ngIf="device.name"><b>Name: </b>{{device.name}}</strong>
                              <br *ngIf="device.name">
                              <strong><b>Type: </b><span class="text-geoloc-gps">GPS</span></strong>
                              <br>
                              <strong><b>Date: </b>{{geoloc.createdAt | date:"dd/MM/yyyy"}}</strong>
                              <br>
                              <strong><b>Time: </b>{{geoloc.createdAt | date:"HH:mm:ss"}}</strong>
                            </agm-info-window>
                          </agm-marker>
                        </ng-container>
                        <!-- Beacon -->
                        <ng-container *ngIf="geoloc.type === 'beacon'">
                          <agm-marker (mouseOut)="markerOut(i)" (mouseOver)="markerOver(i)" [zIndex]="3" [latitude]="geoloc.location.lat" [longitude]="geoloc.location.lng" [iconUrl]="'assets/img/markers/marker-beacon.png'">
                            <agm-info-window id="{{geoloc.id}}">
                              <strong><b>ID: </b><span class="text-device">{{device.id}}</span></strong>
                              <br>
                              <strong *ngIf="device.name"><b>Name: </b>{{device.name}}</strong>
                              <br *ngIf="device.name">
                              <strong><b>Type: </b><span class="text-geoloc-beacon">Beacon</span></strong>
                              <br>
                              <strong><b>Date: </b>{{geoloc.createdAt | date:"dd/MM/yyyy"}}</strong>
                              <br>
                              <strong><b>Time: </b>{{geoloc.createdAt | date:"HH:mm:ss"}}</strong>
                              <br>
                              <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                            </agm-info-window>
                          </agm-marker>
                          <!-- Circle -->
                          <agm-circle *ngIf="isCircleVisible[i]" [visible]="isCircleVisible[i]" [zIndex]="1" [strokePosition]="CENTER" [strokeWeight]="1" [strokeColor]="'#3c58ce'" [fillOpacity]="0.1" [fillColor]="'#3c58ce'" [latitude]="geoloc.location.lat" [longitude]="geoloc.location.lng" [radius]="geoloc.accuracy">
                          </agm-circle>
                          <!-- End Circle -->
                        </ng-container>
                        <!-- WiFi -->
                        <ng-container *ngIf="geoloc.type === 'wifi'">
                          <agm-marker (mouseOut)="markerOut(i)" (mouseOver)="markerOver(i)" [zIndex]="3" [latitude]="geoloc.location.lat" [longitude]="geoloc.location.lng" [iconUrl]="'assets/img/markers/marker-wifi.png'">
                            <agm-info-window id="{{geoloc.id}}">
                              <strong><b>ID: </b><span class="text-device">{{device.id}}</span></strong>
                              <br>
                              <strong *ngIf="device.name"><b>Name: </b>{{device.name}}</strong>
                              <br *ngIf="device.name">
                              <strong><b>Type: </b><span class="text-geoloc-wifi">WiFi</span></strong>
                              <br>
                              <strong><b>Date: </b>{{geoloc.createdAt | date:"dd/MM/yyyy"}}</strong>
                              <br>
                              <strong><b>Time: </b>{{geoloc.createdAt | date:"HH:mm:ss"}}</strong>
                              <br>
                              <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                            </agm-info-window>
                          </agm-marker>
                          <!-- Circle -->
                          <agm-circle *ngIf="isCircleVisible[i]" [visible]="isCircleVisible[i]" [zIndex]="1" [strokePosition]="CENTER" [strokeWeight]="1" [strokeColor]="'#000000'" [fillOpacity]="0.1" [fillColor]="'#000000'" [latitude]="geoloc.location.lat" [longitude]="geoloc.location.lng" [radius]="geoloc.accuracy">
                          </agm-circle>
                          <!-- End Circle -->
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </ng-container>

                </agm-map>
              </ng-container>
              <!-- End Map widget -->

              <!-- Table -->
              <ng-container *ngIf="widget.type === 'table'">
                <div *ngIf="widget.data" class="table-responsive">
                  <!-- Default table -->
                  <table *ngIf="widget.options.tableType==='default'" class="table table-hover" [mfData]="widget.data" #mf="mfDataTable" [mfRowsOnPage]="5">
                    <thead class="thead-inverse">
                    <tr>
                      <th class="text-center">
                        <mfDefaultSorter by="id"><i class="fa fa-sort"></i> ID</mfDefaultSorter>
                      </th>
                      <th class="text-center">
                        <mfDefaultSorter by="data_downlink"><i class="fa fa-sort"></i> Info</mfDefaultSorter>
                      </th>
                      <th class="text-center">
                        <mfDefaultSorter by="updatedAt"><i class="fa fa-sort"></i> Last Message</mfDefaultSorter>
                      </th>
                      <th class="text-center">
                        <mfDefaultSorter by="data_parsed"><i class="fa fa-sort"></i> Data</mfDefaultSorter>
                      </th>
                      <th class="text-center">
                        <mfDefaultSorter by="properties"><i class="fa fa-sort"></i> Properties</mfDefaultSorter>
                      </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let device of mf.data; let i = index">
                      <td class="text-center">
                        <a [routerLink]="[!organization ? '/messages' : '/organization/' + organization.id + '/messages', device.id]"><strong class="text-device">{{device.id}}</strong></a>
                      </td>
                      <td>
                        <div class="small">
                          <span class="text-gray-dark">Name: </span>
                          <strong class="text-device">{{device.name ? device.name : "None"}}</strong>
                        </div>
                        <div class="small">
                          <span class="text-gray-dark">Parser: </span>
                          <strong class="text-parser">{{device.Parser ? device.Parser.name : "None"}}</strong>
                        </div>
                        <div class="small">
                          <span class="text-gray-dark">Category: </span>
                          <strong class="text-category">{{device.Category ? device.Category.name : "None"}}</strong>
                        </div>
                        <div *ngIf="device.data_downlink" class="small">
                          <span class="text-gray-dark">Downlink: </span>
                          <strong class="text-message">{{device.data_downlink}}</strong>
                        </div>
                      </td>

                      <td class="text-center">
                        <div class="small text-gray-dark">{{device.Messages[0].createdAt | date:"yyyy/MM/dd HH:mm:ss"}}
                        </div>
                        <strong>{{device.Messages[0].createdAt | amTimeAgo}}</strong>
                      </td>
                      <td>
                        <div *ngIf="!device.Messages[0]" class="small text-muted">No data</div>
                        <div *ngIf="device.Messages[0]">
                          <div class="small text-gray-dark" *ngFor="let o of device.Messages[0].data_parsed; let i = index">
                          <span *ngIf="o.value">{{o.key}}: <strong>{{o.value}}
                          {{o.unit}}</strong></span>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div *ngIf="!device.categoryId" class="small text-muted">No properties yet</div>
                        <div *ngIf="device.categoryId">
                          <div class="small text-gray-dark" *ngFor="let property of device.properties; let i = index">
                          <span *ngIf="property.value">{{property.key}}: <strong>{{property.value}}
                          {{property.unit}}</strong></span>
                          </div>
                        </div>
                      </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                      <td colspan="4">
                        <mfBootstrapPaginator [rowsOnPageSet]="[5,10,15]"></mfBootstrapPaginator>
                      </td>
                    </tr>
                    </tfoot>
                  </table>
                  <!-- End Default table -->
                  <!-- Custom table -->
                  <table *ngIf="widget.options.tableType === 'custom'" class="table table-hover" [mfData]="widget.data" #mf="mfDataTable" [mfRowsOnPage]="5">
                    <thead class="thead-inverse">
                    <tr>
                      <th class="text-center" *ngFor="let col of widget.options.columns">
                        {{col ? formatTableColumn(col.as) : ""}}
                      </th>
                      <!--<th class="text-center">
                        Statut
                      </th>
                      <th class="text-center">
                        Date de changement de statut
                      </th>
                      <th class="text-center">
                        Actions
                      </th>-->
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let data of mf.data; let i = index">
                      <ng-container *ngFor="let col of widget.options.columns; let j = index">
                        <ng-container [ngSwitch]="col.as">
                          <td *ngSwitchCase="'ID'"
                              class="text-center">
                            <a [routerLink]="['/messages',data[j].value]"><strong class="text-device">{{data[j].value}}</strong></a>
                          </td>
                          <!--<td *ngSwitchCase="'Magasin (category)'"
                              class="text-center text-primary font-weight-bold">
                            {{data[j] ? (data[j].value + (data[j].unit ? data[j].unit : "")) : ""}}
                          </td>-->
                          <td *ngSwitchDefault
                              class="text-center">
                            {{data[j] ? (data[j].value + (data[j].unit ? " " + data[j].unit : "")) : ""}}
                          </td>
                        </ng-container>
                      </ng-container>
                      <!--<ng-container [ngSwitch]="widget.extraData[i].Messages[0].data_parsed[0].value">
                        <td *ngSwitchCase="true"
                            class="text-center text-danger font-weight-bold">
                          Alerte
                        </td>
                        <td *ngSwitchCase="'processing'"
                            class="text-center text-warning font-weight-bold">
                          En cours
                        </td>
                        <td *ngSwitchCase="'treated'"
                            class="text-center text-success font-weight-bold">
                          Ok
                        </td>
                        <td *ngSwitchDefault
                            class="text-center text-success font-weight-bold">
                          None
                        </td>
                      </ng-container>
                      <td class="text-center">
                        {{widget.extraData[i].Messages[0].updatedAt | amTimeAgo}}
                      </td>
                      <td class="text-center">
                        <div class="btn-group-sm">
                          <button class="btn btn-outline-warning btn-round" tooltip="Process"
                                  (click)="markAlertProcess(widget, i)"><i class="fa fa-eye fa-lg"></i></button>
                          <button class="btn btn-outline-success btn-round" tooltip="Done"
                                  (click)="markAlertDone(widget, i)"><i class="fa fa-check fa-lg"></i></button>
                        </div>
                      </td>-->
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                      <td colspan="4">
                        <mfBootstrapPaginator [rowsOnPageSet]="[5,10,15]"></mfBootstrapPaginator>
                      </td>
                    </tr>
                    </tfoot>
                  </table>
                  <!-- End Custom table -->
                </div>
              </ng-container>
              <!-- End Table widget -->

              <!-- Tracking -->
              <ng-container *ngIf="widget.type === 'tracking'">
                <div class="col-md-12">

                  <div #deviceList class="floating-panel" *ngIf="!mobile && widget.data">
                    <div class="m-1" *ngFor="let device of widget.data; let i = index">
                      <label for="{{device.id + widget.id}}" class="switch switch-sm switch-3d switch-device-outline-alt">
                        <input id="{{device.id + widget.id}}"
                               (change)="onDeviceVisibility(i, w)"
                               [(ngModel)]="device.visibility" type="checkbox" class="switch-input">
                        <span class="switch-label"></span>
                        <span class="switch-handle"></span>
                      </label>
                      <strong> {{device.id}} <small *ngIf="device.name">({{device.name}})</small></strong>
                      <!--<input type="text" class="form-control text-center text-device font-weight-bold" value="{{device.name ? device.id + ' (' + device.name + ')' : device.id}}" [readonly]="true">-->
                    </div>
                  </div>

                  <div #deviceListMobile class="floating-panel" *ngIf="mobile && widget.data" style="max-width: 80%; max-height: 20%">
                    <div class="m-1" *ngFor="let device of widget.data; let i = index">
                      <label for="{{device.id + widget.id}}" class="switch switch-sm switch-3d switch-device-outline-alt">
                        <input id="{{device.id + widget.id}}"
                               (change)="onDeviceVisibility(i, w)"
                               [(ngModel)]="device.visibility" type="checkbox" class="switch-input">
                        <span class="switch-label"></span>
                        <span class="switch-handle"></span>
                      </label>
                      <strong>{{device.id}} <small *ngIf="device.name">({{device.name}})</small></strong>
                      <!--<input type="text" class="form-control text-center text-device font-weight-bold" value="{{device.name ? device.id + ' (' + device.name + ')' : device.id}}" [readonly]="true">-->
                    </div>
                  </div>

                  <agm-map id="{{widget.id}}"
                           #agmMap
                           [latitude]="widget.options.lat"
                           [longitude]="widget.options.lng"
                           [zoom]="widget.options.zoom"
                           [fullscreenControl]="true"
                           (mapReady)="onMapTrackingReady($event)"
                           [mapTypeId]="widget.options.mapTypeId !== 'custom' && widget.options.mapTypeId ? widget.options.mapTypeId : 'roadmap'"
                           [styles]="widget.options.style ? widget.options.style : '' ">

                    <input #searchBoxInput *ngIf="!mobile" type="text" class="text-center" placeholder="Search for a place">

                    <agm-marker-cluster *ngIf="widget.options.clustering" [styles]="clusterStyles">
                      <ng-container *ngFor="let device of widget.data; let i = index">
                        <ng-container *ngIf="device.visibility">
                          <!-- Polylines -->
                          <agm-polyline *ngIf="widget.options.polylines"
                                        [zIndex]="2"
                                        [geodesic]="true"
                                        [strokeColor]="device.color"
                                        [strokeOpacity]="0.5">
                            <ng-container *ngFor="let geoloc of device.Geolocs">
                              <agm-polyline-point [latitude]="geoloc.location.lat" [longitude]="geoloc.location.lng">
                              </agm-polyline-point>
                            </ng-container>
                          </agm-polyline>
                          <!-- End Polylines -->

                          <!-- Markers -->
                          <ng-container *ngFor="let geoloc of device.Geolocs; let i = index">
                            <ng-container [ngSwitch]=i>
                              <!-- Start Point -->
                              <ng-container *ngSwitchCase="0">
                                <ng-container *ngIf="geoloc.type === 'sigfox'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-start.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-sigfox">Sigfox</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-success">START</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[0]" [visible]="isCircleVisible[0]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#8d5dd1'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#8d5dd1'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'gps'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-start.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-gps">GPS</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-success">START</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'beacon'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-start.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-beacon">Beacon</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-success">START</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[0]" [visible]="isCircleVisible[0]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#3c58ce'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#3c58ce'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'wifi'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-start.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-wifi">WiFi</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-success">START</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[0]" [visible]="isCircleVisible[0]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#000000'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#000000'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                              </ng-container>
                              <!-- End Start Point -->
                              <!-- Finish Point -->
                              <ng-container *ngSwitchCase="device.Geolocs.length - 1">
                                <ng-container *ngIf="geoloc.type === 'sigfox'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-finish.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-sigfox">Sigfox</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-danger">FINISH</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[i]" [visible]="isCircleVisible[i]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#8d5dd1'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#8d5dd1'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'gps'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-finish.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-gps">GPS</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-danger">FINISH</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'beacon'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-finish.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-beacon">Beacon</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-danger">FINISH</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[i]" [visible]="isCircleVisible[i]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#3c58ce'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#3c58ce'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'wifi'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-finish.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-wifi">WiFi</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-danger">FINISH</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[i]" [visible]="isCircleVisible[i]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#000000'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#000000'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                              </ng-container>
                              <!-- End Finish Point -->
                              <!-- Default -->
                              <ng-container *ngSwitchDefault>
                                <!-- Sigfox -->
                                <agm-marker *ngIf="geoloc.type === 'sigfox'"
                                            (mouseOut)="markerOut(i)"
                                            (mouseOver)="markerOver(i)"
                                            [zIndex]="3"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [iconUrl]="'assets/img/markers/marker-sigfox.png'">
                                  <agm-info-window>
                                    <strong><b>Type: </b><span class="text-geoloc-sigfox">Sigfox</span></strong>
                                    <br>
                                    <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                    <br>
                                    <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                    <br>
                                    <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                    <br>
                                    <strong><b>Position: </b>n°{{i}}</strong>
                                  </agm-info-window>
                                </agm-marker>
                                <!-- Circle -->
                                <agm-circle *ngIf="geoloc.type === 'sigfox' && (circleAccuracy || isCircleVisible[i])" [visible]="isCircleVisible[i]"
                                            [zIndex]="1"
                                            [strokePosition]="CENTER"
                                            [strokeWeight]="1"
                                            [strokeColor]="'#8d5dd1'"
                                            [fillOpacity]="0.1"
                                            [fillColor]="'#8d5dd1'"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [radius]="geoloc.accuracy">
                                </agm-circle>
                                <!-- End Circle -->
                                <!-- End Sigfox -->
                                <!-- GPS -->
                                <agm-marker *ngIf="geoloc.type === 'gps'"
                                            (mouseOut)="markerOut(i)"
                                            (mouseOver)="markerOver(i)"
                                            [zIndex]="3"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [iconUrl]="'assets/img/markers/marker-gps.png'">
                                  <agm-info-window>
                                    <strong><b>Type: </b><span class="text-geoloc-gps">GPS</span></strong>
                                    <br>
                                    <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                    <br>
                                    <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                    <br>
                                    <strong><b>Position: </b>n°{{i}}</strong>
                                  </agm-info-window>
                                </agm-marker>
                                <!-- End GPS -->
                                <!-- Beacon -->
                                <agm-marker *ngIf="geoloc.type === 'beacon'"
                                            (mouseOut)="markerOut(i)"
                                            (mouseOver)="markerOver(i)"
                                            [zIndex]="3"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [iconUrl]="'assets/img/markers/marker-beacon.png'">
                                  <agm-info-window>
                                    <strong><b>Type: </b><span class="text-geoloc-beacon">Beacon</span></strong>
                                    <br>
                                    <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                    <br>
                                    <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                    <br>
                                    <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                    <br>
                                    <strong><b>Position: </b>n°{{i}}</strong>
                                  </agm-info-window>
                                </agm-marker>
                                <!-- Circle -->
                                <agm-circle *ngIf="geoloc.type === 'beacon' && (circleAccuracy || isCircleVisible[i])" [visible]="isCircleVisible[i]"
                                            [zIndex]="1"
                                            [strokePosition]="CENTER"
                                            [strokeWeight]="1"
                                            [strokeColor]="'#3c58ce'"
                                            [fillOpacity]="0.1"
                                            [fillColor]="'#3c58ce'"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [radius]="geoloc.accuracy">
                                </agm-circle>
                                <!-- End Circle -->
                                <!-- End Beacon -->
                                <!-- WiFi -->
                                <agm-marker *ngIf="geoloc.type === 'wifi'"
                                            (mouseOut)="markerOut(i)"
                                            (mouseOver)="markerOver(i)"
                                            [zIndex]="3"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [iconUrl]="'assets/img/markers/marker-wifi.png'">
                                  <agm-info-window>
                                    <strong><b>Type: </b><span class="text-geoloc-wifi">WiFi</span></strong>
                                    <br>
                                    <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                    <br>
                                    <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                    <br>
                                    <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                    <br>
                                    <strong><b>Position: </b>n°{{i}}</strong>
                                  </agm-info-window>
                                </agm-marker>
                                <!-- Circle -->
                                <agm-circle *ngIf="geoloc.type === 'wifi' && (circleAccuracy || isCircleVisible[i])" [visible]="isCircleVisible[i]"
                                            [zIndex]="1"
                                            [strokePosition]="CENTER"
                                            [strokeWeight]="1"
                                            [strokeColor]="'#000000'"
                                            [fillOpacity]="0.1"
                                            [fillColor]="'#000000'"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [radius]="geoloc.accuracy">
                                </agm-circle>
                                <!-- End Circle -->
                                <!-- End WiFi -->
                              </ng-container>
                              <!-- End Default -->
                            </ng-container>
                          </ng-container>
                          <!-- End Markers -->

                          <agm-directions *ngIf="device.Geolocs && device.Geolocs.length > 0 && widget.options.directions"
                                          [directionsDisplayStore]="device.directionsDisplayStore"
                                          [travelMode]="'DRIVING'"
                                          [routesColor]="device.color"
                                          [geolocs]="device.Geolocs">
                          </agm-directions>
                        </ng-container>
                      </ng-container>
                    </agm-marker-cluster>
                    <ng-container *ngIf="!widget.options.clustering">
                      <ng-container *ngFor="let device of widget.data; let i = index">
                        <ng-container *ngIf="device.visibility">
                          <!-- Polylines -->
                          <agm-polyline *ngIf="widget.options.polylines"
                                        [zIndex]="2"
                                        [geodesic]="true"
                                        [strokeColor]="device.color"
                                        [strokeOpacity]="0.5">
                            <ng-container *ngFor="let geoloc of device.Geolocs">
                              <agm-polyline-point [latitude]="geoloc.location.lat" [longitude]="geoloc.location.lng">
                              </agm-polyline-point>
                            </ng-container>
                          </agm-polyline>
                          <!-- End Polylines -->

                          <!-- Markers -->
                          <ng-container *ngFor="let geoloc of device.Geolocs; let i = index">
                            <ng-container [ngSwitch]=i>
                              <!-- Start Point -->
                              <ng-container *ngSwitchCase="0">
                                <ng-container *ngIf="geoloc.type === 'sigfox'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-start.png'">
                                    <agm-info-window>
                                      <strong><b>Type:</b> <span class="text-geoloc-sigfox">Sigfox</span></strong>
                                      <br>
                                      <strong><b>Date:</b> {{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time:</b> {{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy:</b> {{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position:</b> n°{{i}} <span class="text-success">START</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[0]" [visible]="isCircleVisible[0]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#8d5dd1'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#8d5dd1'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'gps'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-start.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-gps">GPS</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-success">START</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'beacon'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-start.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-beacon">Beacon</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-success">START</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[0]" [visible]="isCircleVisible[0]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#3c58ce'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#3c58ce'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'wifi'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-start.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-wifi">WiFi</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-success">START</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[0]" [visible]="isCircleVisible[0]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#000000'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#000000'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                              </ng-container>
                              <!-- End Start Point -->
                              <!-- Finish Point -->
                              <ng-container *ngSwitchCase="device.Geolocs.length - 1">
                                <ng-container *ngIf="geoloc.type === 'sigfox'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-finish.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-sigfox">Sigfox</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-danger">FINISH</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[i]" [visible]="isCircleVisible[i]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#8d5dd1'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#8d5dd1'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'gps'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-finish.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-gps">GPS</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-danger">FINISH</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'beacon'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-finish.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="text-geoloc-beacon">Beacon</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-danger">FINISH</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[i]" [visible]="isCircleVisible[i]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#3c58ce'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#3c58ce'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                                <ng-container *ngIf="geoloc.type === 'wifi'">
                                  <agm-marker
                                    (mouseOut)="markerOut(i)"
                                    (mouseOver)="markerOver(i)"
                                    [zIndex]="4"
                                    [latitude]="geoloc.location.lat"
                                    [longitude]="geoloc.location.lng"
                                    [iconUrl]="'assets/img/markers/marker-finish.png'">
                                    <agm-info-window>
                                      <strong><b>Type: </b><span class="wifi">WiFi</span></strong>
                                      <br>
                                      <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                      <br>
                                      <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                      <br>
                                      <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                      <br>
                                      <strong><b>Position: </b>n°{{i}} <span class="text-danger">FINISH</span></strong>
                                    </agm-info-window>
                                  </agm-marker>
                                  <!-- Circle -->
                                  <agm-circle *ngIf="circleAccuracy || isCircleVisible[i]" [visible]="isCircleVisible[i]"
                                              [zIndex]="1"
                                              [strokePosition]="CENTER"
                                              [strokeWeight]="1"
                                              [strokeColor]="'#000000'"
                                              [fillOpacity]="0.1"
                                              [fillColor]="'#000000'"
                                              [latitude]="geoloc.location.lat"
                                              [longitude]="geoloc.location.lng"
                                              [radius]="geoloc.accuracy">
                                  </agm-circle>
                                  <!-- End Circle -->
                                </ng-container>
                              </ng-container>
                              <!-- End Finish Point -->
                              <!-- Default -->
                              <ng-container *ngSwitchDefault>
                                <!-- Sigfox -->
                                <agm-marker *ngIf="geoloc.type === 'sigfox'"
                                            (mouseOut)="markerOut(i)"
                                            (mouseOver)="markerOver(i)"
                                            [zIndex]="3"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [iconUrl]="'assets/img/markers/marker-sigfox.png'">
                                  <agm-info-window>
                                    <strong><b>Type: </b><span class="text-geoloc-sigfox">Sigfox</span></strong>
                                    <br>
                                    <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                    <br>
                                    <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                    <br>
                                    <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                    <br>
                                    <strong><b>Position: </b>n°{{i}}</strong>
                                  </agm-info-window>
                                </agm-marker>
                                <!-- Circle -->
                                <agm-circle *ngIf="geoloc.type === 'sigfox' && (circleAccuracy || isCircleVisible[i])" [visible]="isCircleVisible[i]"
                                            [zIndex]="1"
                                            [strokePosition]="CENTER"
                                            [strokeWeight]="1"
                                            [strokeColor]="'#8d5dd1'"
                                            [fillOpacity]="0.1"
                                            [fillColor]="'#8d5dd1'"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [radius]="geoloc.accuracy">
                                </agm-circle>
                                <!-- End Circle -->
                                <!-- End Sigfox -->
                                <!-- GPS -->
                                <agm-marker *ngIf="geoloc.type === 'gps'"
                                            (mouseOut)="markerOut(i)"
                                            (mouseOver)="markerOver(i)"
                                            [zIndex]="3"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [iconUrl]="'assets/img/markers/marker-gps.png'">
                                  <agm-info-window>
                                    <strong><b>Type: </b><span class="text-geoloc-gps">GPS</span></strong>
                                    <br>
                                    <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                    <br>
                                    <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                    <br>
                                    <strong><b>Position: </b>n°{{i}}</strong>
                                  </agm-info-window>
                                </agm-marker>
                                <!-- End GPS -->
                                <!-- Beacon -->
                                <agm-marker *ngIf="geoloc.type === 'beacon'"
                                            (mouseOut)="markerOut(i)"
                                            (mouseOver)="markerOver(i)"
                                            [zIndex]="3"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [iconUrl]="'assets/img/markers/marker-beacon.png'">
                                  <agm-info-window>
                                    <strong><b>Type: </b><span class="text-geoloc-beacon">Beacon</span></strong>
                                    <br>
                                    <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                    <br>
                                    <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                    <br>
                                    <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                    <br>
                                    <strong><b>Position: </b>n°{{i}}</strong>
                                  </agm-info-window>
                                </agm-marker>
                                <!-- Circle -->
                                <agm-circle *ngIf="geoloc.type === 'beacon' && (circleAccuracy || isCircleVisible[i])" [visible]="isCircleVisible[i]"
                                            [zIndex]="1"
                                            [strokePosition]="CENTER"
                                            [strokeWeight]="1"
                                            [strokeColor]="'#3c58ce'"
                                            [fillOpacity]="0.1"
                                            [fillColor]="'#3c58ce'"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [radius]="geoloc.accuracy">
                                </agm-circle>
                                <!-- End Circle -->
                                <!-- End Beacon -->
                                <!-- WiFi -->
                                <agm-marker *ngIf="geoloc.type === 'wifi'"
                                            (mouseOut)="markerOut(i)"
                                            (mouseOver)="markerOver(i)"
                                            [zIndex]="3"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [iconUrl]="'assets/img/markers/marker-wifi.png'">
                                  <agm-info-window>
                                    <strong><b>Type: </b><span class="text-geoloc-wifi">WiFi</span></strong>
                                    <br>
                                    <strong><b>Date: </b>{{geoloc.createdAt | date: 'dd/MM/yyyy'}}</strong>
                                    <br>
                                    <strong><b>Time: </b>{{geoloc.createdAt | date: 'HH:mm:ss'}}</strong>
                                    <br>
                                    <strong><b>Accuracy: </b>{{geoloc.accuracy}} m</strong>
                                    <br>
                                    <strong><b>Position: </b>n°{{i}}</strong>
                                  </agm-info-window>
                                </agm-marker>
                                <!-- Circle -->
                                <agm-circle *ngIf="geoloc.type === 'wifi' && (circleAccuracy || isCircleVisible[i])" [visible]="isCircleVisible[i]"
                                            [zIndex]="1"
                                            [strokePosition]="CENTER"
                                            [strokeWeight]="1"
                                            [strokeColor]="'#000000'"
                                            [fillOpacity]="0.1"
                                            [fillColor]="'#000000'"
                                            [latitude]="geoloc.location.lat"
                                            [longitude]="geoloc.location.lng"
                                            [radius]="geoloc.accuracy">
                                </agm-circle>
                                <!-- End Circle -->
                                <!-- End WiFi -->
                              </ng-container>
                              <!-- End Default -->
                            </ng-container>
                          </ng-container>
                          <!-- End Markers -->

                          <agm-directions *ngIf="device.Geolocs && device.Geolocs.length > 0 && widget.options.directions"
                                          [directionsDisplayStore]="device.directionsDisplayStore"
                                          [travelMode]="'DRIVING'"
                                          [routesColor]="device.color"
                                          [geolocs]="device.Geolocs">
                          </agm-directions>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </agm-map>

                </div>
              </ng-container>
              <!-- End Tracking widget -->

              <!-- Alert -->
              <!--<ng-container *ngIf="widget.type === 'alert'">
                <div class="row" *ngIf="widget.data && widget.data[0].data_parsed">
                  <div class="col-md-12 mb-1">
                    <ng-container *ngFor="let o of widget.data[0].data_parsed">
                      <ng-container *ngIf="o.key === widget.options.key">
                        <div *ngIf="o.value" class="text-danger text-center">
                          <i class="fa fa-circle fa-5x"></i>
                          <h3>{{o.value}}</h3>
                        </div>
                        <div *ngIf="!o.value" class="text-success text-center">
                          <i class="fa fa-circle-o fa-5x"></i>
                          <h3>{{o.value}}</h3>
                        </div>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
              </ng-container>-->
              <!-- End Alert -->

              <!-- Gauge -->
              <ng-container *ngIf="widget.type === 'gauge'">
                <div *ngIf="widget.data" class="text-center">
                  <div class="text-center">{{widget.data[0].Messages[0].createdAt | date:"yyyy/MM/dd - HH:mm:ss"}}</div>
                  <ngx-gauge #gauge
                             [min]="widget.options.min"
                             [max]="widget.options.max"
                             [thresholds]="widget.gaugeThresholdConfig"
                             [type]="'arch'"
                             [size]="200"
                             [cap]="'round'"
                             [thick]="15"
                             [value]="widget.value"
                             [label]="widget.label"
                             [append]="widget.unit">
                  </ngx-gauge>
                </div>
              </ng-container>
              <!-- End Gauge -->

              <!-- Chart -->
              <ng-container *ngIf="widget.type === 'line' || widget.type === 'bar'">
                <div *ngIf="widget.data">
                  <nvd3 [options]="widget.options.chartOptions" [data]="widget.data"></nvd3>
                </div>
              </ng-container>
              <!-- End Chart -->

              <!-- Bar custom -->
              <ng-container *ngIf="widget.type === 'bar-custom'">
                <div *ngIf="mobile" class="col-md-12" style="min-height: 200px;">
                  <iframe class="chartjs-hidden-iframe" tabindex="-1"
                          style="display: block; overflow: hidden; border: 0px; margin: 0px; top: 0px; left: 0px; bottom: 0px; right: 0px; height: 100%; width: 100%; position: absolute; pointer-events: none; z-index: -1;"></iframe>
                  <canvas *ngIf="widget.data"
                          baseChart
                          [datasets]="widget.data"
                          [labels]="widget.options.chartLabels"
                          [options]="widget.options.chartOptions"
                          [colors]="widget.options.chartColor"
                          [legend]="true"
                          [chartType]="'bar'"></canvas>
                </div>
                <div *ngIf="!mobile" class="col-md-12" style="min-height: 400px;">
                  <iframe class="chartjs-hidden-iframe" tabindex="-1"
                          style="display: block; overflow: hidden; border: 0px; margin: 0px; top: 0px; left: 0px; bottom: 0px; right: 0px; height: 100%; width: 100%; position: absolute; pointer-events: none; z-index: -1;"></iframe>
                  <canvas *ngIf="widget.data"
                          baseChart
                          [datasets]="widget.data"
                          [labels]="widget.options.chartLabels"
                          [options]="widget.options.chartOptions"
                          [colors]="widget.options.chartColor"
                          [legend]="true"
                          [chartType]="'bar'"></canvas>
                </div>
              </ng-container>
              <!-- End Bar custom -->

              <!-- Stats custom -->
              <ng-container *ngIf="widget.type === 'stats'">
                <div *ngIf="mobile" class="col-md-12" style="min-height: 200px;">
                  <iframe class="chartjs-hidden-iframe" tabindex="-1"
                          style="display: block; overflow: hidden; border: 0px; margin: 0px; top: 0px; left: 0px; bottom: 0px; right: 0px; height: 100%; width: 100%; position: absolute; pointer-events: none; z-index: -1;"></iframe>
                  <canvas *ngIf="widget.data"
                          baseChart
                          [datasets]="widget.data"
                          [labels]="widget.options.chartLabels"
                          [options]="widget.options.chartOptions"
                          [colors]="widget.options.chartColor"
                          [legend]="true"
                          [chartType]="'bar'"></canvas>
                </div>
                <div *ngIf="!mobile" class="col-md-12" style="min-height: 400px;">
                  <iframe class="chartjs-hidden-iframe" tabindex="-1"
                          style="display: block; overflow: hidden; border: 0px; margin: 0px; top: 0px; left: 0px; bottom: 0px; right: 0px; height: 100%; width: 100%; position: absolute; pointer-events: none; z-index: -1;"></iframe>
                  <canvas *ngIf="widget.data"
                          baseChart
                          [datasets]="widget.data"
                          [labels]="widget.options.chartLabels"
                          [options]="widget.options.chartOptions"
                          [colors]="widget.options.chartColor"
                          [legend]="true"
                          [chartType]="'bar'"></canvas>
                </div>
              </ng-container>
              <!-- End Stats custom -->

            </ng-container>
          </div>
        </div>
      </ng-template>
    </div>
    <!-- End For each widget -->
  </div>
  <!-- End Show widgets -->

</div>

<div bsModal #addOrEditWidgetModal="bs-modal" class="modal fade" [config]="{ignoreBackdropClick: true}" tabindex="-1" role="dialog"
     aria-labelledby="addOrEditWidgetModal" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <!-- Form Begin -->
    <div class="modal-content">
      <form class="form-horizontal" #addOrEditWidgetForm="ngForm">
        <div class="modal-header">
          <h4 class="modal-title">{{newWidgetFlag ? "Add new widget" : "Edit widget"}}</h4>
          <button type="button" class="close" (click)="addOrEditWidgetModal.hide()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Add new widget -->
          <div class="col-md-12" *ngIf="newWidgetFlag || editWidgetFlag">

            <div class="form-group row">
              <label class="col-md-3 form-control-label">Name
                <small class="text-danger">(required)</small>
              </label>
              <div class="col-md-9">
                <input type="text" class="form-control" placeholder="Widget name" name="newWidget.name" required [(ngModel)]="newWidget.name">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-md-3 form-control-label">Description</label>
              <div class="col-md-9">
                <input type="text" class="form-control" placeholder="Widget description" name="newWidget.description" [(ngModel)]="newWidget.description">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-md-3 form-control-label">Icon <i class="fa {{newWidget.icon}}"></i></label>
              <div class="col-md-9">
                <angular2-multiselect #selectOneWidgetIcon
                                      name="iconWidgetSelect"
                                      [data]="fontAwesomeList"
                                      [(ngModel)]="selectedWidgetIcon"
                                      (onSelect)="newWidget.icon = $event.id; selectOneWidgetIcon.isActive = false;"
                                      (onDeSelect)="newWidget.icon = ''"
                                      [settings]="selectIconSettings">
                  <c-item>
                    <ng-template let-item="item">
                      <label style="color: #333;min-width: 150px;">{{item.itemName}}</label>
                      <i class="fa {{item.id}}" style="width: 16px; margin-right: 5px;"></i>
                    </ng-template>
                  </c-item>
                </angular2-multiselect>
              </div>
            </div>
            <div class="form-group row">
              <label class="col-md-3 form-control-label">Width
                <small class="text-danger">(required)</small>
                <br>
                <small>Between 1 and 12</small>
              </label>
              <div class="col-md-9">
                <input type="number" min="1" max="12" class="form-control" placeholder="Widget width" name="newWidget.width" required [(ngModel)]="newWidget.width">
              </div>
            </div>
            <div class="form-group row">
              <label class="col-md-3 form-control-label">Type
                <small class="text-danger">(required)</small>
              </label>
              <div class="col-md-9">
                <angular2-multiselect #selectOne
                                      name="selectWidgetType"
                                      [data]="selectWidgetType"
                                      [(ngModel)]="selectedWidgetType"
                                      (onSelect)="newWidget.type = $event.id; selectOne.isActive = false;"
                                      (onDeSelect)="newWidget.type = ''"
                                      [settings]="selectOneSettings"
                                      required>
                </angular2-multiselect>
              </div>
            </div>

            <!-- Image widget -->
            <ng-container *ngIf="newWidget.type === 'image'">
              <div class="form-group row">
                <label class="col-md-3 form-control-label">Image</label>
                <div class="col-md-9">
                  <input type="text"
                         class="form-control"
                         placeholder="Past the URL of the image here"
                         name="newWidget.image"
                         [(ngModel)]="newWidget.image"
                         required>
                </div>
              </div>
            </ng-container>
            <!-- End Image widget -->

            <!-- Value widget -->
            <ng-container *ngIf="newWidget.type === 'value'">
              <div class="form-group row">
                <label class="col-md-3 form-control-label">Device
                </label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOneDevice
                                        name="selectDevices"
                                        [data]="selectDevices"
                                        [(ngModel)]="selectedDevices"
                                        [settings]="selectOneDeviceSettings"
                                        (onSelect)="setFilter(); loadKeys(); selectOneDevice.isActive = false;"
                                        (onDeSelect)="setFilter();"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>
              <div class="form-group row" *ngIf="selectedDevices.length > 0">
                <label class="col-md-3 form-control-label">Key</label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOneKey
                                        name="selectKeys"
                                        [data]="selectKeys"
                                        [(ngModel)]="selectedKeys"
                                        [settings]="selectOneSettings"
                                        (onDeSelect)="setFilter();"
                                        (onSelect)="setFilter(); selectOneKey.isActive = false;"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>
            </ng-container>
            <!-- End Value widget -->

            <!-- Map widget -->
            <ng-container *ngIf="newWidget.type === 'map'">
              <div class="form-group row">
                <label class="col-md-3 form-control-label">Categories / Devices
                </label>
                <div class="col-md-4">
                  <angular2-multiselect name="selectCategories"
                                        [data]="selectCategories"
                                        [(ngModel)]="selectedCategories"
                                        [settings]="selectCategoriesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>

                <div class="col-md-5">
                  <angular2-multiselect name="selectDevices"
                                        [data]="selectDevices"
                                        [(ngModel)]="selectedDevices"
                                        [settings]="selectDevicesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Default zoom<br>
                  <small>Between 1 and 13</small>
                </label>
                <div class="col-md-9">
                  <input type="number" min="1" max="13" class="form-control" placeholder="Zoom" name="newWidget.zoom" [(ngModel)]="newWidget.options.zoom">
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Default latitude</label>
                <div class="col-md-9">
                  <input type="number" class="form-control" placeholder="Latitude" name="newWidget.lat" [(ngModel)]="newWidget.options.lat">
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Default longitude</label>
                <div class="col-md-9">
                  <input type="number" class="form-control" placeholder="Longitude" name="newWidget.lng" [(ngModel)]="newWidget.options.lng">
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Map type</label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOne
                                        name="selectMapType"
                                        [data]="selectMapType"
                                        [(ngModel)]="selectedMapType"
                                        (onSelect)="newWidget.options.mapTypeId = $event.id; selectOne.isActive = false;"
                                        [settings]="selectOneSettings">
                  </angular2-multiselect>
                </div>
              </div>

              <div class="form-group row" *ngIf="newWidget.options.mapTypeId === 'custom'">
                <label class="col-md-3 form-control-label">Snazzy Map</label>
                <div class="col-md-9">
                  <input type="text"
                         class="form-control"
                         placeholder="Past your snazzy map code here"
                         name="newWidget.snazzymap"
                         [(ngModel)]="newWidget.options.style">
                </div>
              </div>
            </ng-container>
            <!-- End Map widget -->

            <!-- Table widget -->
            <ng-container *ngIf="newWidget.type === 'table'">
              <div class="form-group row">
                <label class="col-md-3 form-control-label">Categories / Devices
                </label>
                <div class="col-md-4">
                  <angular2-multiselect name="selectCategories"
                                        [data]="selectCategories"
                                        [(ngModel)]="selectedCategories"
                                        [settings]="selectCategoriesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>

                <div class="col-md-5">
                  <angular2-multiselect name="selectDevices"
                                        [data]="selectDevices"
                                        [(ngModel)]="selectedDevices"
                                        [settings]="selectDevicesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Table Type
                  <small class="text-danger">(required)</small>
                  <br>
                </label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOne
                                        name="selectTableType"
                                        [data]="selectTableType"
                                        [(ngModel)]="selectedTableType"
                                        (onDeSelect)="newWidget.options.tableType = ''"
                                        (onSelect)="newWidget.options.tableType = $event.id; addTableType($event.id); selectOne.isActive = false;"
                                        [settings]="selectOneSettings"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>

              <ng-container *ngIf="newWidget.options.tableType === 'custom'">
                <ng-container *ngIf="loadingTableOptions">
                  <div class="sk-double-bounce">
                    <div class="sk-child sk-double-bounce1"></div>
                    <div class="sk-child sk-double-bounce2"></div>
                  </div>
                </ng-container>
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead class="">
                    <tr>
                      <th class="text-center" *ngFor="let col of newWidget.options.columns; let i = index">
                        <select *ngIf="!newWidget.options.columns[i]" name="categoryId" class="form-control" size="1" [(ngModel)]="newWidget.options.columns[i]" (ngModelChange)="addTableType($event)">
                          <option *ngFor="let option of newWidget.options.tableColumnOptions" [ngValue]="option">{{option.as}}</option>
                        </select>
                        <ng-container *ngIf="newWidget.options.columns[i]">
                          <label>{{newWidget.options.columns[i].as}}</label>
                          <button class="btn btn-sm btn-round btn-outline-danger" tooltip="Remove column" (click)="removeTableColumn(newWidget, i)"><i class="fa fa-trash fa-md"></i></button>
                        </ng-container>
                      </th>
                      <th class="text-center">
                        <button class="btn btn-sm btn-round btn-outline-primary" tooltip="Add column" (click)="addEmptyTableColumn()"><i class="fa fa-plus fa-lg"></i></button>
                      </th>
                    </tr>
                    </thead>
                  </table>
                </div>
                <!--<div class="form-group row" *ngIf="selectedCategories.length > 0 || selectedDevices.length > 0">
                  <label class="col-md-3 form-control-label">Keys</label>
                  <div class="col-md-9">
                    <angular2-multiselect name="selectKeys"
                                          (onOpen)="loadKeys()"
                                          [data]="selectKeys"
                                          [(ngModel)]="selectedKeys"
                                          [settings]="selectKeysSettings"
                                          (onSelect)="setFilter();"
                                          (onDeSelect)="setFilter();"
                                          (onSelectAll)="setFilter();"
                                          (onDeSelectAll)="setFilter();"
                                          required>
                    </angular2-multiselect>
                  </div>
                </div>-->
              </ng-container>
            </ng-container>
            <!-- End Table widget -->

            <!-- Tracking widget -->
            <ng-container *ngIf="newWidget.type === 'tracking'">
              <div class="form-group row">
                <label class="col-md-3 form-control-label">Categories / Devices
                </label>
                <div class="col-md-4">
                  <angular2-multiselect name="selectCategories"
                                        [data]="selectCategories"
                                        [(ngModel)]="selectedCategories"
                                        [settings]="selectCategoriesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>

                <div class="col-md-5">
                  <angular2-multiselect name="selectDevices"
                                        [data]="selectDevices"
                                        [(ngModel)]="selectedDevices"
                                        [settings]="selectDevicesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Directions routes<br>
                </label>
                <div class="col-md-9">
                  <label class="switch switch-text switch-primary">
                    <input type="checkbox" [checked]="newWidget.options.directions"
                           (change)="newWidget.options.directions = !newWidget.options.directions" class="switch-input" checked="">
                    <span class="switch-label" data-on="On" data-off="Off"></span>
                    <span class="switch-handle"></span>
                  </label>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Polylines<br>
                </label>
                <div class="col-md-9">
                  <label class="switch switch-text switch-primary">
                    <input type="checkbox" [checked]="newWidget.options.polylines"
                           (change)="newWidget.options.polylines = !newWidget.options.polylines" class="switch-input" checked="">
                    <span class="switch-label" data-on="On" data-off="Off"></span>
                    <span class="switch-handle"></span>
                  </label>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Marker clustering<br>
                </label>
                <div class="col-md-9">
                  <label class="switch switch-text switch-primary">
                    <input type="checkbox" [checked]="newWidget.options.clustering"
                           (change)="newWidget.options.clustering = !newWidget.options.clustering" class="switch-input" checked="">
                    <span class="switch-label" data-on="On" data-off="Off"></span>
                    <span class="switch-handle"></span>
                  </label>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Default zoom<br>
                  <small>Between 1 and 13</small>
                </label>
                <div class="col-md-9">
                  <input type="number" min="1" max="13" class="form-control" placeholder="Zoom" name="newWidget.zoom" [(ngModel)]="newWidget.options.zoom">
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Default latitude</label>
                <div class="col-md-9">
                  <input type="number" class="form-control" placeholder="Latitude" name="newWidget.lat" [(ngModel)]="newWidget.options.lat">
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Default longitude</label>
                <div class="col-md-9">
                  <input type="number" class="form-control" placeholder="Longitude" name="newWidget.lng" [(ngModel)]="newWidget.options.lng">
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Beginning at
                  <small class="text-danger">(required)</small>
                </label>
                <div class="col-md-9">
                  <angular2-date-picker name="dateTime"
                                        [(ngModel)]="selectedDateTimeBegin"
                                        (onDateSelect)="selectedDateTimeBegin = $event; setFilter();"
                                        [settings]="dateTimeSettings"
                                        required>
                  </angular2-date-picker>
                </div>
              </div>

              <!--<div class="form-group row">
                <label class="col-md-3 form-control-label">Or:
                </label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOneTrackingDuration
                                        name="trackingDuration"
                                        [data]="selectTrackingDuration"
                                        [(ngModel)]="selectedTrackingDuration"
                                        (onSelect)="newWidget.options.trackingDuration = $event.id; selectOne.isActive = false;"
                                        [settings]="selectOneSettings"
                                        required>
                </div>
              </div>-->

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Geoloc type
                  <small class="text-danger">(required)</small>
                </label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOneGeolocType
                                        name="geolocType"
                                        [data]="selectGeolocType"
                                        [(ngModel)]="selectedGeolocType"
                                        (onSelect)="newWidget.options.geolocType = $event.id; selectOneGeolocType.isActive = false; setFilter();"
                                        [settings]="selectOneSettings"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Map type</label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOne
                                        name="selectMapType"
                                        [data]="selectMapType"
                                        [(ngModel)]="selectedMapType"
                                        (onSelect)="newWidget.options.mapTypeId = $event.id; selectOne.isActive = false;"
                                        [settings]="selectOneSettings">
                  </angular2-multiselect>
                </div>
              </div>

              <div class="form-group row" *ngIf="newWidget.options.mapTypeId === 'custom'">
                <label class="col-md-3 form-control-label">Snazzy Map</label>
                <div class="col-md-9">
                  <input type="text"
                         class="form-control"
                         placeholder="Past your snazzy map code here"
                         name="newWidget.snazzymap"
                         [(ngModel)]="newWidget.options.style">
                </div>
              </div>
            </ng-container>
            <!-- End Tracking widget -->

            <!-- Alert widget -->
            <!--<ng-container *ngIf="newWidget.type === 'alert'">
              <div class="form-group row">
                <label class="col-md-3 form-control-label">Device
                </label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOneDevice
                                        name="selectDevices"
                                        [data]="selectDevices"
                                        [(ngModel)]="selectedDevices"
                                        [settings]="selectOneDeviceSettings"
                                        (onSelect)="setFilter(); loadKeys(); selectOneDevice.isActive = false;"
                                        (onDeSelect)="setFilter();">
                  </angular2-multiselect>
                </div>
              </div>
              <div class="form-group row" *ngIf="selectedDevices.length > 0">
                <label class="col-md-3 form-control-label">Key</label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOneKey
                                        name="selectKeys"
                                        [data]="selectKeys"
                                        [(ngModel)]="selectedKeys"
                                        [settings]="selectOneSettings"
                                        (onDeSelect)="setFilter();"
                                        (onSelect)="setFilter(); selectOneKey.isActive = false;"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>
            </ng-container>-->
            <!-- End Alert widget -->

            <!-- Gauge widget -->
            <ng-container *ngIf="newWidget.type === 'gauge'">
              <div class="form-group row">
                <label class="col-md-3 form-control-label">Device
                </label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOneDevice
                                        name="selectDevices"
                                        [data]="selectDevices"
                                        [(ngModel)]="selectedDevices"
                                        [settings]="selectOneDeviceSettings"
                                        (onSelect)="setFilter(); loadKeys(); selectOneDevice.isActive = false;"
                                        (onDeSelect)="setFilter();"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>
              <div class="form-group row" *ngIf="selectedDevices.length > 0">
                <label class="col-md-3 form-control-label">Key</label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOneKey
                                        name="selectKeys"
                                        [data]="selectKeys"
                                        [(ngModel)]="selectedKeys"
                                        [settings]="selectOneSettings"
                                        (onDeSelect)="setFilter();"
                                        (onSelect)="setFilter(); selectOneKey.isActive = false;"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>
              <div class="form-group row">
                <label class="offset-1 col-md-3 form-control-label">Gauge range</label>
                <div class="col-md-8">
                  <div class="row">
                    <div class="col-md-6">
                      <label class="form-control-label">Min value</label>
                      <input type="number" class="form-control" name="newWidget.options.min"
                             [(ngModel)]="newWidget.options.min">
                    </div>
                    <div class="col-md-6">
                      <label class="form-control-label">Max value</label>
                      <input type="number" class="form-control" name="newWidget.options.max"
                             [(ngModel)]="newWidget.options.max">
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
            <!-- End Gauge widget -->

            <!-- Line & Bar widget -->
            <ng-container *ngIf="newWidget.type === 'line' || newWidget.type === 'bar'">
              <div class="form-group row">
                <label class="col-md-3 form-control-label">Categories / Devices
                </label>
                <div class="col-md-4">
                  <angular2-multiselect name="selectCategories"
                                        [data]="selectCategories"
                                        [(ngModel)]="selectedCategories"
                                        [settings]="selectCategoriesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>

                <div class="col-md-5">
                  <angular2-multiselect name="selectDevices"
                                        [data]="selectDevices"
                                        [(ngModel)]="selectedDevices"
                                        [settings]="selectDevicesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>
              </div>

              <div class="form-group row" *ngIf="selectedCategories.length > 0 || selectedDevices.length > 0">
                <label class="col-md-3 form-control-label">Keys</label>
                <div class="col-md-9">
                  <angular2-multiselect name="selectKeys"
                                        (onOpen)="loadKeys()"
                                        [data]="selectKeys"
                                        [(ngModel)]="selectedKeys"
                                        [settings]="selectKeysSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Beginning at
                </label>
                <div class="col-md-9">
                  <angular2-date-picker name="dateTime"
                                        [(ngModel)]="selectedDateTimeBegin"
                                        (onDateSelect)="selectedDateTimeBegin = $event; setFilter();"
                                        [settings]="dateTimeSettings"
                                        required>
                  </angular2-date-picker>
                </div>
              </div>

            </ng-container>
            <!-- End Line & Bar widget -->

            <!-- Bar custom widget -->
            <ng-container *ngIf="newWidget.type === 'bar-custom'">
              <div class="form-group row">
                <label class="col-md-3 form-control-label">Categories / Devices
                </label>
                <div class="col-md-4">
                  <angular2-multiselect name="selectCategories"
                                        [data]="selectCategories"
                                        [(ngModel)]="selectedCategories"
                                        [settings]="selectCategoriesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>

                <div class="col-md-5">
                  <angular2-multiselect name="selectDevices"
                                        [data]="selectDevices"
                                        [(ngModel)]="selectedDevices"
                                        [settings]="selectDevicesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>
              </div>

              <div class="form-group row" *ngIf="selectedCategories.length > 0 || selectedDevices.length > 0">
                <label class="col-md-3 form-control-label">Key</label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOneKey
                                        (onOpen)="loadKeys()"
                                        name="selectKeys"
                                        [data]="selectKeys"
                                        [(ngModel)]="selectedKeys"
                                        [settings]="selectOneSettings"
                                        (onDeSelect)="setFilter();"
                                        (onSelect)="setFilter(); selectOneKey.isActive = false;"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>

              <div class="form-group row" *ngIf="selectedCategories.length > 0 || selectedDevices.length > 0 && selectedKeys.length > 0">
                <label class="col-md-3 form-control-label">Exact value</label>
                <div class="col-md-9">
                  <input type="text"
                         class="form-control"
                         placeholder="Exact value for this key"
                         name="newWidget.options.exact_value"
                         [(ngModel)]="newWidget.options.exact_value"
                         required>
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-3 form-control-label">Beginning at
                </label>
                <div class="col-md-9">
                  <angular2-date-picker name="dateTime"
                                        [(ngModel)]="selectedDateTimeBegin"
                                        (onDateSelect)="selectedDateTimeBegin = $event; setFilter();"
                                        [settings]="dateTimeSettings"
                                        required>
                  </angular2-date-picker>
                </div>
              </div>

            </ng-container>
            <!-- End Bar custom widget -->

            <!-- Stats widget -->
            <ng-container *ngIf="newWidget.type === 'stats'">
              <div class="form-group row">
                <label class="col-md-3 form-control-label">Device
                </label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOneDevice
                                        name="selectDevices"
                                        [data]="selectDevices"
                                        [(ngModel)]="selectedDevices"
                                        [settings]="selectOneDeviceSettings"
                                        (onSelect)="setFilter(); loadKeys(); selectOneDevice.isActive = false;"
                                        (onDeSelect)="setFilter();"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>

              <!--<div class="form-group row">
                <label class="col-md-3 form-control-label">Categories / Devices
                </label>
                <div class="col-md-4">
                  <angular2-multiselect name="selectCategories"
                                        [data]="selectCategories"
                                        [(ngModel)]="selectedCategories"
                                        [settings]="selectCategoriesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>

                <div class="col-md-5">
                  <angular2-multiselect name="selectDevices"
                                        [data]="selectDevices"
                                        [(ngModel)]="selectedDevices"
                                        [settings]="selectDevicesSettings"
                                        (onSelect)="setFilter();"
                                        (onDeSelect)="setFilter();"
                                        (onSelectAll)="setFilter();"
                                        (onDeSelectAll)="setFilter();">
                  </angular2-multiselect>
                </div>
              </div>-->

              <div class="form-group row" *ngIf="selectedDevices.length > 0">
                <label class="col-md-3 form-control-label">Period</label>
                <div class="col-md-9">
                  <angular2-multiselect #selectOne
                                        name="selectBarMsgCounterPeriod"
                                        [data]="selectBarMsgCounterPeriod"
                                        [(ngModel)]="selectedBarMsgCounterPeriod"
                                        (onSelect)="newWidget.options.period = $event.id; selectOne.isActive = false;"
                                        [settings]="selectOneSettings"
                                        required>
                  </angular2-multiselect>
                </div>
              </div>

            </ng-container>
            <!-- End Stats widget -->

          </div>
          <!-- End new widget -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="addOrEditWidgetModal.hide()">Close</button>
          <button class="btn btn-primary" *ngIf="newWidgetFlag" [disabled]="!addOrEditWidgetForm.form.valid" (click)="addWidget()"><i
            class="fa fa-check"></i> Add widget
          </button>
          <button class="btn btn-primary" *ngIf="editFlag" [disabled]="!addOrEditWidgetForm.form.valid" (click)="updateWidget()"><i
            class="fa fa-check"></i> Update widget
          </button>
        </div>
      </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<toaster-container [toasterconfig]="toasterconfig"></toaster-container>
